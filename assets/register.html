<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/login.css">
    <script src="script.js"></script>
    <script src="menu.js"></script>
    <!-- Google Fonts - Roboto -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <title>Đăng ký - HLK Championship 2025</title>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <div class="navbar-left">
                    <div class="navbar-logo-container">
                        <img src="assets/logo_light.png" alt="HLK Championship 2025 Logo" class="logo-light" width="100px">
                        <img src="assets/logo_dark.png" alt="HLK Championship 2025 Logo" class="logo-dark" width="100px">
                    </div>
                </div>
                
                <div class="navbar-center">
                    <ul class="nav-links">
                        <li><a href="index.html">Trang chủ</a></li>
                        <li><a href="join.html">Tham gia</a></li>
                        <li><a href="index.html#rules">Thể lệ</a></li>
                        <li><a href="index.html#list">Danh sách</a></li>
                        <li><a href="index.html#news">Bảng tin</a></li>
                    </ul>
                </div>
                
                <div class="navbar-right">
                    <button class="navbar-btn theme-btn" title="Toggle Theme" onclick="toggleTheme()">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </nav>
        </div>
    </header>
    <main class="login-main">
        <div class="container">
            <div class="login-container">
                <div class="login-card">
                    <div class="login-header">
                        <h1>Đăng ký tài khoản</h1>
                        <p>Tạo tài khoản mới để tham gia HLK Championship 2025</p>
                    </div>

                    <form class="login-form register-form" id="registerForm" method="post" action="php/register.php">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fullName">Họ và tên *</label>
                                <input 
                                    type="text" 
                                    id="fullName" 
                                    name="fullName" 
                                    required
                                    placeholder="Nhập họ và tên đầy đủ"
                                    autocomplete="name"
                                >
                                <span class="form-error" id="fullName-error"></span>
                            </div>
                            
                            <div class="form-group">
                                <label for="studentId">Mã số học sinh *</label>
                                <input 
                                    type="text" 
                                    id="studentId" 
                                    name="studentId" 
                                    required
                                    placeholder="Ví dụ: 210221"
                                    pattern="^[A-Za-z]{0,3}[0-9]{4,8}$"
                                >
                                <span class="form-error" id="studentId-error"></span>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="class">Lớp *</label>
                                <select id="class" name="class" required>
                                    <option value="">Chọn lớp</option>
                                    <option value="Văn">Văn</option>
                                    <option value="Toán">Toán</option>
                                    <option value="Lí">Lí</option>
                                    <option value="Hóa">Hóa</option>
                                    <option value="Sinh">Sinh</option>
                                    <option value="Anh">Anh</option>
                                    <option value="Anh 1">Anh 1</option>
                                    <option value="Anh 2">Anh 2</option>
                                    <option value="Tin">Tin</option>
                                    <option value="Sử">Sử</option>
                                    <option value="Nguồn 1">Nguồn 1</option>
                                    <option value="Nguồn 2">Nguồn 2</option>
                                </select>
                                <span class="form-error" id="class-error"></span>
                            </div>

                            <div class="form-group">
                                <label for="grade">Khoá *</label>
                                <select id="grade" name="grade" required>
                                    <option value="">Chọn khoá</option>
                                    <option value="K28">K28</option>
                                    <option value="K29">K29</option>
                                    <option value="K30">K30</option>
                                    <option value="K31">K31</option>
                                    <option value="K32">K32</option>
                                </select>
                                <span class="form-error" id="grade-error"></span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="email">Email *</label>
                            <input 
                                type="email" 
                                id="email" 
                                name="email" 
                                required
                                placeholder="Nhập địa chỉ email"
                                autocomplete="email"
                            >
                            <span class="form-error" id="email-error"></span>
                        </div>

                        <div class="form-group">
                            <label for="username">Tên đăng nhập *</label>
                            <input 
                                type="text" 
                                id="username" 
                                name="username" 
                                required
                                placeholder="Chọn tên đăng nhập"
                                autocomplete="username"
                                pattern="^[a-zA-Z0-9_]{4,20}$"
                            >
                            <span class="form-error" id="username-error"></span>
                            <small class="form-hint">Chỉ sử dụng chữ cái, số và dấu gạch dưới (4-20 ký tự)</small>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="password">Mật khẩu *</label>
                                <div class="password-input-container">
                                    <input 
                                        type="password" 
                                        id="password" 
                                        name="password" 
                                        required
                                        placeholder="Tạo mật khẩu"
                                        autocomplete="new-password"
                                        minlength="6"
                                    >
                                    <button type="button" class="password-toggle" onclick="togglePassword('password')">
                                        <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        <svg class="eye-off-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <line x1="1" y1="1" x2="23" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </button>
                                </div>
                                <span class="form-error" id="password-error"></span>
                            </div>

                            <div class="form-group">
                                <label for="confirmPassword">Xác nhận mật khẩu *</label>
                                <div class="password-input-container">
                                    <input 
                                        type="password" 
                                        id="confirmPassword" 
                                        name="confirmPassword" 
                                        required
                                        placeholder="Nhập lại mật khẩu"
                                        autocomplete="new-password"
                                        minlength="6"
                                    >
                                    <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')">
                                        <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        <svg class="eye-off-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <line x1="1" y1="1" x2="23" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </button>
                                </div>
                                <span class="form-error" id="confirmPassword-error"></span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="gameId">Game UID Liên Quân Mobile *</label>
                            <input 
                                type="text" 
                                id="gameId" 
                                name="gameId"
                                placeholder="UID trong game"
                                required
                            >
                            <span class="form-error" id="gameId-error"></span>
                        </div>

                        <div class="form-options">
                            <label class="checkbox-container">
                                <input type="checkbox" id="terms" name="terms" required>
                                <span class="checkmark"></span>
                                Tôi đồng ý với <a href="#" class="terms-link">thể lệ giải đấu</a> và <a href="#" class="privacy-link">chính sách bảo mật</a>
                            </label>
                        </div>

                        <div class="form-options">
                            <label class="checkbox-container">
                                <input type="checkbox" id="newsletter" name="newsletter">
                                <span class="checkmark"></span>
                                Nhận thông báo về giải đấu và sự kiện qua email
                            </label>
                        </div>

                        <button type="submit" class="btn btn-primary login-btn">
                            <span class="btn-text">Đăng ký tài khoản</span>
                            <div class="btn-loading">
                                <div class="spinner"></div>
                                <span>Đang xử lý...</span>
                            </div>
                        </button>
                    </form>
                    
                    <div class="login-footer">
                        <p>Đã có tài khoản? <a href="login.html" class="register-link">Đăng nhập ngay</a></p>
                    </div>
                </div>

                <div class="login-info">
                    <div class="card">
                        <h3>Tham gia HLK Championship 2025</h3>
                        <ul class="info-list">
                            <li>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Cơ hội giành giải thưởng giá trị lớn
                            </li>
                            <li>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Thi đấu cùng bạn bè trong trường
                            </li>
                            <li>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Nhận vé tham gia lucky draw từ nhà tài trợ
                            </li>
                            <li>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Trải nghiệm thi đấu esports chuyên nghiệp
                            </li>
                            <li>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Kết nối với cộng đồng game thủ trường THPT chuyên HLK
                            </li>
                        </ul>

                        <div class="tournament-info">
                            <h4>Thông tin giải đấu</h4>
                            <div class="info-item">
                                <strong>Game:</strong> Liên Quân Mobile
                            </div>
                            <div class="info-item">
                                <strong>Đối tượng:</strong> Học sinh THPT chuyên HLK
                            </div>
                            <div class="info-item">
                                <strong>Hình thức:</strong> Đấu loại trực tiếp 5v5
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <h1>HLK Championship 2025</h1>
            <p>© 2025 HLK Championship. Tất cả quyền được bảo lưu. Liên hệ: info@hlkchampionship.com</p>
        </div>
    </footer>
    <script>
        /* -------------------- VALIDATION -------------------- */
        function validateForm() {
        let isValid = true;
        const errors = {};

        // clear
        document.querySelectorAll('.form-error').forEach(el => {
            el.textContent = '';
            el.classList.remove('show');
        });

        // full name
        const fullName = document.getElementById('fullName').value.trim();
        if (!fullName) { errors.fullName = 'Vui lòng nhập họ và tên'; isValid = false; }
        else if (fullName.length < 2) { errors.fullName = 'Họ tên phải có ít nhất 2 ký tự'; isValid = false; }

        // student id (cho phép 0–3 ký tự A-Z + 4–8 số)
        const studentId = document.getElementById('studentId').value.trim();
        const studentIdPattern = /^[A-Za-z]{0,3}[0-9]{4,8}$/;
        if (!studentId) { errors.studentId = 'Vui lòng nhập mã số học sinh'; isValid = false; }
        else if (!studentIdPattern.test(studentId)) { errors.studentId = 'Mã số học sinh không đúng định dạng'; isValid = false; }

        // class
        const classValue = document.getElementById('class').value;
        if (!classValue) { errors.class = 'Vui lòng chọn lớp'; isValid = false; }

        // grade
        const grade = document.getElementById('grade').value;
        const gradePattern = /^(K28|K29|K30|K31|K32)$/;
        if (!grade) { errors.grade = 'Vui lòng chọn khoá'; isValid = false; }
        else if (!gradePattern.test(grade)) { errors.grade = 'Khoá phải là K28, K29, K30, K31 hoặc K32'; isValid = false; }

        // email
        const email = document.getElementById('email').value.trim();
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email) { errors.email = 'Vui lòng nhập email'; isValid = false; }
        else if (!emailPattern.test(email)) { errors.email = 'Email không đúng định dạng'; isValid = false; }

        // username
        const username = document.getElementById('username').value.trim();
        const usernamePattern = /^[a-zA-Z0-9_]{4,20}$/;
        if (!username) { errors.username = 'Vui lòng nhập tên đăng nhập'; isValid = false; }
        else if (!usernamePattern.test(username)) { errors.username = 'Tên đăng nhập chỉ chứa chữ cái, số và _ (4-20 ký tự)'; isValid = false; }

        // password
        const password = document.getElementById('password').value;
        if (!password) { errors.password = 'Vui lòng nhập mật khẩu'; isValid = false; }
        else if (password.length < 6) { errors.password = 'Mật khẩu phải có ít nhất 6 ký tự'; isValid = false; }

        // confirm password
        const confirmPassword = document.getElementById('confirmPassword').value;
        if (!confirmPassword) { errors.confirmPassword = 'Vui lòng xác nhận mật khẩu'; isValid = false; }
        else if (password !== confirmPassword) { errors.confirmPassword = 'Mật khẩu xác nhận không khớp'; isValid = false; }

        // game uid
        const gameId = document.getElementById('gameId').value.trim();
        if (!gameId) { errors.gameId = 'Vui lòng nhập UID trong game'; isValid = false; }

        // terms
        if (!document.getElementById('terms').checked) {
            errors.terms = 'Vui lòng đồng ý với thể lệ giải đấu';
            isValid = false;
        }

        // render errors
        for (const k in errors) {
            const el = document.getElementById(k + '-error');
            if (el) { el.textContent = errors[k]; el.classList.add('show'); }
        }

        return isValid;
        }

        /* -------------------- SUBMIT -------------------- */
        const formEl = document.getElementById('registerForm');
        formEl.addEventListener('submit', async function (e) {
        e.preventDefault();
        if (!validateForm()) return;

        const registerBtn = document.querySelector('.login-btn');
        const btnText = registerBtn.querySelector('.btn-text');
        const btnLoading = registerBtn.querySelector('.btn-loading');

        // loading on
        btnText.style.display = 'none';
        btnLoading.style.display = 'flex';
        registerBtn.disabled = true;

        try {
            const formData = new FormData(formEl);

            // optional: mark ajax for server
            const resp = await fetch(formEl.action || 'php/register.php', {
            method: 'POST',
            body: formData,
            headers: { 'X-Requested-With': 'XMLHttpRequest' },
            credentials: 'same-origin'
            });

            // fallback khi server trả HTML (không JSON)
            const contentType = resp.headers.get('Content-Type') || '';
            if (!contentType.includes('application/json')) {
            // nếu server render trang thành công → chuyển hướng sang login
            if (resp.ok) {
                window.location.href = 'login.html';
                return;
            }
            throw new Error('Đăng ký thất bại');
            }

            const data = await resp.json();

            if (data.success) {
            // ưu tiên redirect server gửi
            if (data.redirect) {
                window.location.href = data.redirect;
            } else {
                window.location.href = 'login.html';
            }
            return;
            }

            // hiển thị lỗi field từ server: { errors: { field: 'message', ... }, message: '...' }
            if (data.errors && typeof data.errors === 'object') {
            for (const k in data.errors) {
                const el = document.getElementById(k + '-error');
                if (el) { el.textContent = data.errors[k]; el.classList.add('show'); }
            }
            }

            if (data.message) {
            alert(data.message); // thông báo tổng quát (nếu cần)
            }

        } catch (err) {
            console.error(err);
            alert('Có lỗi xảy ra. Vui lòng thử lại.');
        } finally {
            // loading off
            btnText.style.display = 'block';
            btnLoading.style.display = 'none';
            registerBtn.disabled = false;
        }
        });

        /* -------------------- PASSWORD TOGGLE -------------------- */
        function togglePassword(fieldId) {
        const input = document.getElementById(fieldId);
        const eye = input.parentElement.querySelector('.eye-icon');
        const eyeOff = input.parentElement.querySelector('.eye-off-icon');
        const isPwd = input.type === 'password';
        input.type = isPwd ? 'text' : 'password';
        eye.style.display = isPwd ? 'none' : 'block';
        eyeOff.style.display = isPwd ? 'block' : 'none';
        }

        /* -------------------- REALTIME CHECKS -------------------- */
        document.getElementById('username').addEventListener('input', function () {
        const v = this.value.trim();
        const el = document.getElementById('username-error');
        const re = /^[a-zA-Z0-9_]{4,20}$/;
        if (v && !re.test(v)) { el.textContent = 'Tên đăng nhập chỉ chứa chữ cái, số và _ (4-20 ký tự)'; el.classList.add('show'); }
        else { el.textContent = ''; el.classList.remove('show'); }
        });

        document.getElementById('confirmPassword').addEventListener('input', function () {
        const pw = document.getElementById('password').value;
        const cpw = this.value;
        const el = document.getElementById('confirmPassword-error');
        if (cpw && pw !== cpw) { el.textContent = 'Mật khẩu xác nhận không khớp'; el.classList.add('show'); }
        else { el.textContent = ''; el.classList.remove('show'); }
        });

        /* -------------------- PROFILE DROPDOWN (GIỮ NGUYÊN) -------------------- */
        let isDropdownOpen = false;
        function setCookie(name, value, days) {
        const expires = new Date(Date.now() + days*864e5).toUTCString();
        document.cookie = `${name}=${value};expires=${expires};path=/`;
        }
        function getCookie(name) {
        const nameEQ = name + "=";
        return document.cookie.split(';').map(s=>s.trim()).find(c=>c.indexOf(nameEQ)===0)?.substring(nameEQ.length) || null;
        }
        function deleteCookie(name) {
        document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/`;
        }
        function checkLoginStatus() {
        const tok = getCookie('hlk_user_token');
        const uname = getCookie('hlk_user_name');
        const uclass = getCookie('hlk_user_class');
        const container = document.querySelector('.profile-dropdown-container');
        if (tok && uname) { container.classList.add('logged-in'); updateUserInfo(uname, uclass); }
        else { container.classList.remove('logged-in'); }
        }
        function updateUserInfo(name, className) {
        const userNameElement = document.getElementById('userName');
        const userClassElement = document.getElementById('userClass');
        const userInitialsElement = document.getElementById('userInitials');
        if (userNameElement) userNameElement.textContent = name;
        if (userClassElement) userClassElement.textContent = className || 'Học viên HLK';
        if (userInitialsElement) userInitialsElement.textContent = name.split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2);
        }
        function toggleProfileDropdown(){ isDropdownOpen ? closeProfileDropdown() : openProfileDropdown(); }
        function openProfileDropdown(){ const d=document.querySelector('.profile-dropdown'); if (d){ d.classList.add('show'); isDropdownOpen = true; } }
        function closeProfileDropdown(){ const d=document.querySelector('.profile-dropdown'); if (d){ d.classList.remove('show'); isDropdownOpen = false; } }
        function viewProfile(){ alert('Chức năng xem hồ sơ đang được phát triển!'); closeProfileDropdown(); }
        function viewTournaments(){ alert('Chức năng xem giải đấu đang được phát triển!'); closeProfileDropdown(); }
        function viewNotifications(){ alert('Chức năng thông báo đang được phát triển!'); closeProfileDropdown(); }
        function viewSettings(){ alert('Chức năng cài đặt đang được phát triển!'); closeProfileDropdown(); }
        function logout(){
        if (confirm('Bạn có chắc muốn đăng xuất?')) {
            deleteCookie('hlk_user_token'); deleteCookie('hlk_user_name'); deleteCookie('hlk_user_class');
            checkLoginStatus(); closeProfileDropdown(); alert('Đã đăng xuất thành công!');
        }
        }
        document.addEventListener('click', (e)=> {
        const container = document.querySelector('.profile-dropdown-container');
        if (container && !container.contains(e.target)) closeProfileDropdown();
        });
        document.addEventListener('DOMContentLoaded', checkLoginStatus);
        </script>
 </body>
 </html>
 